# æ•°æ®åº“æ™ºèƒ½ä½“æ¨¡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ¨¡å—åŒ…å«ä¸“é—¨è´Ÿè´£æ•°æ®åº“æ“ä½œçš„æ™ºèƒ½ä½“ï¼Œå°†æ•°æ®åº“ç›¸å…³åŠŸèƒ½ä»ä¸šåŠ¡é€»è¾‘ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå®ç°æ›´æ¸…æ™°çš„æ¶æ„è®¾è®¡ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„
```
ä¸šåŠ¡æ™ºèƒ½ä½“ (TestCaseGeneratorAgent)
    â†“ æ¶ˆæ¯ä¼ é€’
æ•°æ®åº“æ™ºèƒ½ä½“ (TestCaseSaverAgent)
    â†“ è°ƒç”¨
ä»“å‚¨å±‚ (TestCaseRepository)
    â†“ æ“ä½œ
æ•°æ®æ¨¡å‹å±‚ (TestCase, User, Project...)
    â†“ æ˜ å°„
æ•°æ®åº“å±‚ (MySQL)
```

### èŒè´£åˆ†ç¦»
- **ä¸šåŠ¡æ™ºèƒ½ä½“**: ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å¤„ç†ï¼ˆå¦‚æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆï¼‰
- **æ•°æ®åº“æ™ºèƒ½ä½“**: ä¸“é—¨å¤„ç†æ•°æ®æŒä¹…åŒ–æ“ä½œ
- **ä»“å‚¨å±‚**: æä¾›æ•°æ®è®¿é—®æŠ½è±¡
- **æ¨¡å‹å±‚**: å®šä¹‰æ•°æ®ç»“æ„å’Œå…³ç³»

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. TestCaseSaverAgent
æµ‹è¯•ç”¨ä¾‹æ•°æ®åº“ä¿å­˜æ™ºèƒ½ä½“ï¼Œè´Ÿè´£ï¼š
- æ¥æ”¶æµ‹è¯•ç”¨ä¾‹ä¿å­˜è¯·æ±‚
- æ•°æ®éªŒè¯å’Œè½¬æ¢
- æ‰¹é‡ä¿å­˜æ“ä½œ
- é”™è¯¯å¤„ç†å’Œå›æ»š
- ä¿å­˜ç»“æœåé¦ˆ

### 2. TestCaseRepository
æµ‹è¯•ç”¨ä¾‹ä»“å‚¨ç±»ï¼Œæä¾›ï¼š
- åŸºç¡€CRUDæ“ä½œ
- å¤æ‚æŸ¥è¯¢æ–¹æ³•
- æ‰¹é‡æ“ä½œæ”¯æŒ
- ç³»ç»Ÿæ•°æ®ç®¡ç†
- äº‹åŠ¡å¤„ç†

### 3. æ•°æ®æ¨¡å‹
å…¼å®¹æ–°æ•°æ®åº“ç»“æ„çš„æ¨¡å‹å®šä¹‰ï¼š
- å®Œæ•´çš„å­—æ®µæ˜ å°„
- æšä¸¾ç±»å‹å®šä¹‰
- å…³è”å…³ç³»é…ç½®
- Pydanticæ¨¡å‹æ”¯æŒ

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨
```python
from app.agents.database.test_case_saver_agent import TestCaseSaverAgent, TestCaseSaveRequest

# åˆ›å»ºä¿å­˜æ™ºèƒ½ä½“
saver_agent = TestCaseSaverAgent()

# æ„å»ºä¿å­˜è¯·æ±‚
save_request = TestCaseSaveRequest(
    session_id="session-123",
    test_cases=test_cases_data,
    project_id="project-id",
    created_by="user-id"
)

# ä¿å­˜æµ‹è¯•ç”¨ä¾‹
result = await saver_agent._save_test_cases_to_database(save_request)
```

### 2. ä»“å‚¨ä½¿ç”¨
```python
from app.database.repositories.test_case_repository import TestCaseRepository

# åˆ›å»ºä»“å‚¨å®ä¾‹
repo = TestCaseRepository()

# ä½¿ç”¨æ•°æ®åº“ä¼šè¯
async with db_manager.get_session() as session:
    # åˆ›å»ºæµ‹è¯•ç”¨ä¾‹
    test_case = await repo.create_test_case(session, test_case_data)
    
    # æŸ¥è¯¢æµ‹è¯•ç”¨ä¾‹
    test_cases = await repo.get_test_cases_by_project(session, project_id)
    
    # æœç´¢æµ‹è¯•ç”¨ä¾‹
    results = await repo.search_test_cases(session, keyword="ç™»å½•")
```

### 3. æ™ºèƒ½ä½“é—´é€šä¿¡
```python
# åœ¨ç”Ÿæˆæ™ºèƒ½ä½“ä¸­å‘é€åˆ°ä¿å­˜æ™ºèƒ½ä½“
await self.publish_message(
    save_request,
    topic_id=TopicId(type=TopicTypes.TEST_CASE_SAVER.value, source=self.id.key)
)
```

## ğŸ“Š æ•°æ®æµç¨‹

### æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå’Œä¿å­˜æµç¨‹
```
1. ç”¨æˆ·è¯·æ±‚ â†’ TestCaseGeneratorAgent
2. ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹æ•°æ®
3. å‘é€ä¿å­˜è¯·æ±‚ â†’ TestCaseSaverAgent
4. æ•°æ®éªŒè¯å’Œè½¬æ¢
5. è°ƒç”¨ TestCaseRepository
6. æ‰§è¡Œæ•°æ®åº“æ“ä½œ
7. è¿”å›ä¿å­˜ç»“æœ
8. é€šçŸ¥ç”¨æˆ·å®Œæˆ
```

### é”™è¯¯å¤„ç†æµç¨‹
```
1. æ•è·å¼‚å¸¸
2. è®°å½•é”™è¯¯æ—¥å¿—
3. å›æ»šäº‹åŠ¡
4. æ„å»ºé”™è¯¯å“åº”
5. é€šçŸ¥è°ƒç”¨æ–¹
```

## ğŸ”’ æ•°æ®å®‰å…¨

### 1. ç³»ç»Ÿæ•°æ®ç®¡ç†
- è‡ªåŠ¨åˆ›å»ºAIç”¨æˆ·å’Œé»˜è®¤é¡¹ç›®
- ç¡®ä¿å¤–é”®çº¦æŸæ»¡è¶³
- é˜²æ­¢å­¤ç«‹æ•°æ®äº§ç”Ÿ

### 2. äº‹åŠ¡å¤„ç†
- æ‰¹é‡æ“ä½œä½¿ç”¨äº‹åŠ¡
- å¼‚å¸¸æ—¶è‡ªåŠ¨å›æ»š
- æ•°æ®ä¸€è‡´æ€§ä¿è¯

### 3. æƒé™æ§åˆ¶
- åŸºäºç”¨æˆ·IDçš„æƒé™éªŒè¯
- é¡¹ç›®çº§åˆ«çš„æ•°æ®éš”ç¦»
- æ“ä½œæ—¥å¿—è®°å½•

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. æ‰¹é‡æ“ä½œ
- æ”¯æŒæ‰¹é‡åˆ›å»ºæµ‹è¯•ç”¨ä¾‹
- å‡å°‘æ•°æ®åº“è¿æ¥æ¬¡æ•°
- æé«˜å¤„ç†æ•ˆç‡

### 2. è¿æ¥æ± ç®¡ç†
- å¼‚æ­¥æ•°æ®åº“è¿æ¥
- è¿æ¥æ± å¤ç”¨
- è‡ªåŠ¨è¿æ¥å›æ”¶

### 3. æŸ¥è¯¢ä¼˜åŒ–
- ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
- åˆ†é¡µæŸ¥è¯¢æ”¯æŒ
- æ¡ä»¶æŸ¥è¯¢ä¼˜åŒ–

## ğŸ§ª æµ‹è¯•

### è¿è¡Œç¤ºä¾‹
```bash
cd backend
python examples/test_case_generation_example.py
```

### å•å…ƒæµ‹è¯•
```bash
pytest tests/test_database_agents.py
```

## ğŸ“ é…ç½®

### æ•°æ®åº“é…ç½®
```python
# åœ¨ app/core/config.py ä¸­é…ç½®
DATABASE_URL = "mysql+asyncmy://user:password@localhost:3306/database"
```

### æ™ºèƒ½ä½“é…ç½®
```python
# ç³»ç»Ÿå¸¸é‡
DEFAULT_PROJECT_ID = "project-default"
AI_USER_ID = "user-ai-agent"
```

## ğŸ”„ æ‰©å±•

### æ·»åŠ æ–°çš„æ•°æ®åº“æ™ºèƒ½ä½“
1. ç»§æ‰¿ BaseAgent
2. å®ç°æ¶ˆæ¯å¤„ç†æ–¹æ³•
3. æ·»åŠ åˆ°ç±»å‹å®šä¹‰
4. æ³¨å†Œåˆ°è·¯ç”±

### æ·»åŠ æ–°çš„ä»“å‚¨ç±»
1. ç»§æ‰¿ BaseRepository
2. å®ç°ç‰¹å®šä¸šåŠ¡æ–¹æ³•
3. æ·»åŠ åˆ°æ¨¡å—å¯¼å‡º

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æäº¤Issueã€‚
